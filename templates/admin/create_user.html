<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script>{% extends "layouts/AdminLayout.html" %}

{% block content %}
<div class="p-8">
    <a href="/admin/users" class="mb-6 inline-flex items-center text-gray-600 hover:text-gray-800">
        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
        Назад к пользователям
    </a>

    <div class="max-w-2xl mx-auto">
        <div class="mb-8">
            <h1 class="text-3xl text-gray-900 mb-2 flex items-center gap-3">
                <svg class="w-8 h-8 text-pink-600" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                Создать нового пользователя
            </h1>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
            {% if error %}
                <div class="mb-4 p-4 bg-red-50 text-red-600 rounded-md">{{ error }}</div>
            {% endif %}
            <form method="post" class="space-y-6">
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Имя *</label>
                        <input
                            id="name"
                            name="name"
                            required
                            value="{{ form_data.name if form_data else '' }}"
                            placeholder="Анна"
                            class="mt-1 w-full border border-gray-300 rounded-md p-2"
                        />
                    </div>
                    <div>
                        <label for="surname" class="block text-sm font-medium text-gray-700">Фамилия</label>
                        <input
                            id="surname"
                            name="surname"
                            value="{{ form_data.surname if form_data else '' }}"
                            placeholder="Иванова"
                            class="mt-1 w-full border border-gray-300 rounded-md p-2"
                        />
                    </div>
                </div>

                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700">Логин *</label>
                    <input
                        id="username"
                        name="username"
                        required
                        value="{{ form_data.username if form_data else '' }}"
                        placeholder="anna_ivanova"
                        class="mt-1 w-full border border-gray-300 rounded-md p-2"
                    />
                    <p class="text-sm text-gray-500 mt-1">Будет использоваться для входа в систему</p>
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input
                        id="email"
                        name="email"
                        type="email"
                        value="{{ form_data.email if form_data else '' }}"
                        placeholder="anna@example.com"
                        class="mt-1 w-full border border-gray-300 rounded-md p-2"
                    />
                    <p class="text-sm text-gray-500 mt-1">Необязательно, для восстановления пароля</p>
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Пароль *</label>
                    <input
                        id="password"
                        name="password"
                        type="password"
                        required
                        minlength="6"
                        placeholder="••••••"
                        class="mt-1 w-full border border-gray-300 rounded-md p-2"
                    />
                    <p class="text-sm text-gray-500 mt-1">Минимум 6 символов</p>
                </div>

                <div>
                    <label for="role" class="block text-sm font-medium text-gray-700">Роль *</label>
                    <select name="role" required class="mt-1 w-full border border-gray-300 rounded-md p-2">
                        <option value="employee" {% if form_data and form_data.role == "employee" %}selected{% endif %}>Сотрудник</option>
                        <option value="manager" {% if form_data and form_data.role == "manager" %}selected{% endif %}>Менеджер</option>
                        <option value="admin" {% if form_data and form_data.role == "admin" %}selected{% endif %}>Администратор</option>
                    </select>
                    <div class="mt-2 p-4 bg-gray-50 rounded-lg text-sm text-gray-600 space-y-1">
                        <p><strong>Сотрудник:</strong> базовые права - просмотр своих записей и графика</p>
                        <p><strong>Менеджер:</strong> расширенные права - работа с клиентами и аналитикой</p>
                        <p><strong>Администратор:</strong> полный доступ ко всем функциям системы</p>
                    </div>
                </div>

                <button type="submit" class="w-full bg-pink-600 text-white rounded-md px-4 py-2 hover:bg-pink-700 flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    Создать аккаунт
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}